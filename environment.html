<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Teapot Cubemap</title>
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#7b965f">
        <meta name="msapplication-TileColor" content="#d4e1f2">
        <meta name="theme-color" content="#ffffff">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                font-family: Monospace;
                background-color: #FEFFFF;
                margin: 0px;
                overflow: hidden;
            }
        </style>
    </head>
    <body>
    <div style="width: 100%; text-align: center; padding-top: 20px">
        <input type="button" id='toChapel' value="⛪️" style="display: none;"
            onclick="
                document.getElementById('toChapel').style='display: none;';
                document.getElementById('toCanyon').style='margin: auto;';
                loadEnvironmentMap('data/textures/LancellottiChapel/');
            " >
        <input type="button" id='toCanyon' value="🏜" style="display: none;"
            onclick="
                document.getElementById('toCanyon').style='display: none;';
                document.getElementById('toChapel').style='margin: auto;';
                loadEnvironmentMap('data/textures/canyon/');
            " >
    </div>
    <div id="container">
        <div id="controlBar" style="position:absolute; left:50%; top:50%; transform: translate(-50%, -50%);">

            <input type="input" id="meshInputFile" style="display: none;" onclick="loadFile()">
            <label><input type="checkbox" id="showAxesCheckbox" style="display: none;" onchange="toggleAxes(this.checked)" checked="false"></label>
            <label><input type="checkbox" id="showWireframeCheckbox" style="display: none;" onchange="toggleWireframe(this.checked)" checked="false"></label>
            <label><input type="checkbox" id="showNormalsCheckbox" style="display: none;" onchange="toggleNormals(this.checked)" checked="false"></label>
            <label><input type="checkbox" id="fixLightsToCameraCheckbox" style="display: none;" onchange="toggleFixLightsToCamera(this.checked)" checked="false"></label>
            

            <input type="range" id="normalLengthRange" min="0.02" style="display: none;" max="0.5" step="0.02" value="0.3" oninput="setNormalLength(0.3)">
            
            <input type="range" style="display: none;" id="exposureRange" min="-4.0" max="4.0" step="0.5" value="0.0" oninput="setUniformLog('exposure', this.value)">
            

            <input type="button" id="meshInputButton" value="Render Interactive Teapot" 
                onclick="
                document.getElementById('meshInputFile').click();
                document.getElementById('toCanyon').style='';
                document.getElementById('controlBar').style = 'display: none;'
                " >
            <script>"loadFile();"</script>
        </div>
    </div>
        <script src="js/three.min.js"></script>
        <script src="js/BufferGeometryUtils.js"></script>
        <script src="js/Detector.js"></script>
        <script src="js/OrbitControls.js"></script>
        <script src="js/OBJLoader.js"></script>
<!-----------------------------------------------------------------------------
        VERTEX SHADER
------------------------------------------------------------------------------>
        <script id="vertexShader" type="x-shader/x-vertex">
// Provided by Three.js:
// = object.matrixWorld
// uniform mat4 modelMatrix;

// = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

// = camera.projectionMatrix
// uniform mat4 projectionMatrix;

// = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

// = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

// = camera position in world space
// uniform vec3 cameraPosition;

// RenderMesh Input
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;

varying vec3 vNormal; // Normal in eye space.
varying vec4 vPosition; // Position in eye space.

void main() {
    // Calculate point in eye space.
    vPosition = modelViewMatrix * vec4(position, 1.0);
    // Calculate projected point.
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);

    vNormal = normalize((normalMatrix * normal).xyz);

}
        </script>
<!-----------------------------------------------------------------------------
        FRAGMENT SHADER
------------------------------------------------------------------------------>
        <script id="fragmentShader" type="x-shader/x-fragment">
uniform float exposure;

uniform samplerCube environmentMap;

varying vec3 vNormal; // Normal in eye space.
varying vec4 vPosition; // Position in eye space.

vec3 to_sRGB(vec3 c) { return pow(c, vec3(1.0/2.2)); }
vec3 from_sRGB(vec3 c) { return pow(c, vec3(2.2)); }

void main() {

    vec3 reflTexCoord = reflect(vPosition.xyz, vNormal);
    vec3 environmentColor = textureCube(environmentMap, reflTexCoord).rgb;
    gl_FragColor = vec4((environmentColor * exposure),1.0);
}
        </script>
<!-----------------------------------------------------------------------------
        END SHADERS
------------------------------------------------------------------------------>
        <script src="js/A4Common.js"></script>
        <script>
            commonInit();
            init();
            animate();
            
            function init() {
                loadEnvironmentMap('data/textures/LancellottiChapel/');
            
                addLight(new THREE.Vector3(50, 50, 100), new THREE.Vector3(0.8, 0.8, 0.8));
                addLight(new THREE.Vector3(-50, -50, -50), new THREE.Vector3(0.5, 0.5, 0.6));
            }
        </script>
    </body>
</html>
